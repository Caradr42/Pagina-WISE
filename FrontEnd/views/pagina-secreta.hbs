<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Modo Administrador</title>

    <!-- Google font -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:200,400,700" rel="stylesheet">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">    <link rel="canonical" href="https://getbootstrap.com/docs/4.4/examples/grid/">
	<!-- Si utilizamos componentes de Bootstrap que requieran Javascript agregar estos tres archivos -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<!-- VueJs -->
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="/stylesheets/googleButton.css">
</head>

<script>
    async function updateAdminStatus(OID, status, email){
        console.log("making admin: " + OID);

        let action = status? "agregar" : "remover";
        
        if (confirm(`Estas segur@ de que quieres ${action} el admin ${email}`)) {
            const param = {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body:  JSON.stringify({
                    OID: OID,
                    status: status
                }),
                method: "POST"
            }
            fetch('/admin/updateAdminStatus', param)
                .then(dat => location.reload())
                .catch(err => console.log(err));
        }
    }
</script>

<body>
    <nav class="navbar fixed-top ">
        <a class="navbar-brand" href="/"><img src="/Logo_WiSE_Oficial-140px-white.png" class="img-responsive"></a>

        <a class="navbar-brand" href="/logout"><div class="google-btn">
                <div class="google-icon-wrapper">
                    <img class="google-icon" src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"/>
                </div>
                <p class="btn-text"><b>Log Out</b></p>
        </div></a>
    </nav>

    <div id="app" class="container">
        <h1 class="display-2" style="color:#111">Modo administrador</h1> 
        
        <hr>

        <h3><img src={{user.img}} class="img-responsive" style="width:60px; height: 60px; border-radius:30px;"> - Bienvenid@ - </h3>
        <h4>User: {{user.name}} </h4>
        <h4>email: {{user.email}} </h4>

        <hr>
        <h3>Usuarios:</h4>

        <table class="table table-striped">
            <thead class="thead-dark">
                <tr>
                <th scope="col"></th>
                <th scope="col">Name</th>
                <th scope="col">email</th>
                <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {{#each users}}
                    <tr {{#if this.isAdmin}} style="background-color: rgba(35, 185, 43, 0.753);" {{/if}} >
                    <th scope="row"><img src={{this.img}} class="img-responsive" style="width:60px; height: 60px; border-radius:30px;"></th>
                    <td class="align-middle">{{this.name}}</td>
                    <td class="align-middle">{{this.email}}</td>
                    <td class="align-middle">
                        {{#if this.isAdmin}}
                            {{#if (areNotEqual this.OID ../user.OID)}} 
                                <button type="button" class="btn btn-danger" onclick="updateAdminStatus('{{this.OID}}', false, '{{this.email}}')">Quitar administrador</button>
                            {{/if}}
                        {{else}}<button type="button" class="btn btn-success" onclick="updateAdminStatus('{{this.OID}}', true, '{{this.email}}')">Hacer administrador</button> 
                        {{/if}}
                    </td>
                    </tr>
                {{/each}}
            </tbody>
        </table>
    </div>    
</body>

